# Pré-processamento de Dados

Este roteiro reúne exemplos do DALToolbox e de bibliotecas amplamente usadas, alinhados aos slides de `3-Preprocessamento.pdf`.  
Cada chunk indica o **slide** correspondente.

## Configuração

```{r libraries}
# Slides 1–3: panorama do pré-processamento
require_pkg <- function(pkg) {
  if (!requireNamespace(pkg, quietly = TRUE)) {
    stop(sprintf("Pacote '%s' não instalado. Instale com install.packages('%s').", pkg, pkg))
  }
  invisible(TRUE)
}

pkgs <- c("daltoolbox","dplyr","tidyr","ggplot2","caret","scales")
invisible(lapply(pkgs, require_pkg))

suppressPackageStartupMessages({
  library(daltoolbox)
  library(dplyr)
  library(tidyr)
  library(ggplot2)
  library(caret)
  library(scales)
})
```

## Limpeza de dados

```{r na_removal}
# Slide 6: Como lidar com dados ausentes (remoção)
iris <- datasets::iris
iris.na <- iris
iris.na$Sepal.Length[2] <- NA
obj <- na_removal()
iris.na.omit <- transform(obj, iris.na)
head(iris.na.omit)
```

```{r imputation}
# Slide 6: Imputação simples (média/mediana)
iris_na <- iris
iris_na$Sepal.Length[c(2, 10, 25)] <- NA
imp <- imputation_simple(method = "median")
imp <- fit(imp, iris_na)
iris_imputed <- transform(imp, iris_na)
summary(iris_imputed$Sepal.Length)
```

```{r outliers_boxplot}
# Slide 10: Remoção de outliers (boxplot)
out_obj <- outliers_boxplot()
out_obj <- fit(out_obj, iris)
iris.clean <- transform(out_obj, iris)
head(iris.clean)
```

```{r outliers_gaussian}
# Slide 8–10: Remoção de outliers (regra 3σ)
out_obj <- outliers_gaussian()
out_obj <- fit(out_obj, iris)
iris.clean <- transform(out_obj, iris)
head(iris.clean)
```

```{r loess}
# Slide 8: Suavização por regressão (LOESS)
set.seed(123)
x <- seq(1, 100)
y <- sin(x / 10) + rnorm(100, sd = 0.2)
dat <- data.frame(x, y)
ggplot(dat, aes(x, y)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "loess", se = FALSE, color = "red") +
  labs(title = "Suavização LOESS", x = "x", y = "y")
```

## Redução e representação

```{r pca}
# Slides 20–22: PCA
iris <- datasets::iris
mypca <- dt_pca("Species")
mypca <- fit(mypca, datasets::iris)
iris.pca <- transform(mypca, iris)
head(iris.pca)
```

```{r feature_selection}
# Slides 23–24: Seleção de atributos (correlação alta)
fs <- feature_selection_corr(cutoff = 0.9)
fs <- fit(fs, iris)
iris_fs <- transform(fs, iris)
setdiff(names(iris), names(iris_fs))
```

```{r feature_generation}
# Slide 26: Geração de features
gen <- feature_generation(
  Sepal.Area = Sepal.Length * Sepal.Width,
  Petal.Area = Petal.Length * Petal.Width,
  Sepal.Ratio = Sepal.Length / Sepal.Width
)
iris_feat <- transform(gen, iris)
head(iris_feat)
```

```{r aggregation}
# Slide 27: Agregação de dados
agg <- aggregation(
  "Species",
  mean_sepal = mean(Sepal.Length),
  sd_sepal = sd(Sepal.Length),
  n = n()
)
transform(agg, iris)
```

## Transformação e normalização

```{r minmax}
# Slide 29: Normalização Min-Max
norm <- minmax()
norm <- fit(norm, iris)
ndata <- transform(norm, iris)
summary(ndata)
```

```{r zscore}
# Slide 29: Normalização Z-Score
norm <- zscore()
norm <- fit(norm, iris)
ndata <- transform(norm, iris)
summary(ndata)
```

```{r norm_compare}
# Slide 30: Comparação visual de normalização
vals <- data.frame(
  x = iris$Sepal.Length,
  minmax = scales::rescale(iris$Sepal.Length),
  zscore = as.numeric(scale(iris$Sepal.Length))
)

vals_long <- vals %>%
  pivot_longer(cols = c(x, minmax, zscore), names_to = "method", values_to = "value")

ggplot(vals_long, aes(value, fill = method)) +
  geom_histogram(bins = 20, alpha = 0.6, position = "identity") +
  facet_wrap(~ method, scales = "free") +
  labs(title = "Comparação visual de normalização")
```

## Discretização e suavização

```{r smooth_interval}
# Slides 33–35: Binning por intervalos
obj <- smoothing_inter(n = 2)
obj <- fit(obj, iris$Sepal.Length)
sl.bi <- transform(obj, iris$Sepal.Length)
table(sl.bi)
```

```{r smooth_freq}
# Slides 33–35: Binning por frequência (quantis)
obj <- smoothing_freq(n = 2)
obj <- fit(obj, iris$Sepal.Length)
sl.bi <- transform(obj, iris$Sepal.Length)
table(sl.bi)
```

```{r smooth_cluster}
# Slide 35: Discretização via clustering
obj <- smoothing_cluster(n = 2)
obj <- fit(obj, iris$Sepal.Length)
sl.bi <- transform(obj, iris$Sepal.Length)
table(sl.bi)
```

## Hierarquias e mapeamento categórico

```{r onehot}
# Slides 38–39: Mapeamento categórico (one-hot)
cm <- categ_mapping("Species")
iris_cm <- transform(cm, iris)
head(iris_cm)
```

```{r hierarchy}
# Slides 36–37: Hierarquia de conceitos (exemplo simples)
hc <- hierarchy_cut(
  "Sepal.Length",
  breaks = c(-Inf, 5.5, 6.5, Inf),
  labels = c("baixo", "medio", "alto")
)
iris_h <- transform(hc, iris)
table(iris_h$Sepal.Length.Level)
```

## Amostragem e balanceamento

```{r sample_random}
# Slides 40–41: Amostragem aleatória
tt <- train_test(sample_random(), iris)
table(tt$train$Species)
```

```{r sample_stratified}
# Slides 41–43: Amostragem estratificada
tt <- train_test(sample_stratified("Species"), iris)
table(tt$train$Species)
```

```{r with_without_replacement}
# Slide 42: Amostragem com e sem reposição
srswor <- sample_simple(size = 10, replace = FALSE, seed = 123)
srswr <- sample_simple(size = 10, replace = TRUE, seed = 123)
srswor <- transform(srswor, iris$Sepal.Length)
srswr <- transform(srswr, iris$Sepal.Length)
srswor
srswr
```

```{r cluster_sampling}
# Slide 43: Amostragem por cluster (exemplo simples)
sc <- sample_cluster("Species", n_clusters = 2, seed = 123)
cluster_sample <- transform(sc, iris)
table(cluster_sample$Species)
```

```{r imbalance}
# Slides 45–46: Balanceamento de classes (up/down sampling)
set.seed(123)
iris_imb <- iris %>% filter(Species != "setosa")
iris_imb$Species <- droplevels(iris_imb$Species)

down <- sample_balance("Species", method = "down", seed = 123)
down <- transform(down, iris_imb)
table(down$Species)

up <- sample_balance("Species", method = "up", seed = 123)
up <- transform(up, iris_imb)
table(up$Species)
```

## Referências
- Han, J., Kamber, M., Pei, J. (2011). *Data Mining: Concepts and Techniques*.
- García, S., Luengo, J., Herrera, F. (2014). *Data Preprocessing in Data Mining*.
- Little, R. J. A., Rubin, D. B. (2002). *Statistical Analysis with Missing Data*.
- Tukey, J. W. (1977). *Exploratory Data Analysis*.
- Satopaa, V. et al. (2011). Finding a “Kneedle” in a Haystack. *ICDCS*.

